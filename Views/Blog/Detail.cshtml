@model HotelBooking.Models.Blog

@{
    ViewData["Title"] = "Details";
}

<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Sona Template">
    <meta name="keywords" content="Sona, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Sona | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cabin:400,500,600,700&display=swap" rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="~/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="~/css/flaticon.css" type="text/css">
    <link rel="stylesheet" href="~/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="~/css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="~/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Section Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="canvas-open">
        <i class="icon_menu"></i>
    </div>
    <div class="offcanvas-menu-wrapper">
        <div class="canvas-close">
            <i class="icon_close"></i>
        </div>
        <div class="search-icon search-switch">
            <i class="icon_search"></i>
        </div>
        <div class="header-configure-area">
            <div class="language-option">
                <img src="img/flag.jpg" alt="">
                <span>EN <i class="fa fa-angle-down"></i></span>
                <div class="flag-dropdown">
                    <ul>
                        <li><a href="#">Zi</a></li>
                        <li><a href="#">Fr</a></li>
                    </ul>
                </div>
            </div>
            <a href="#" class="bk-btn">Booking Now</a>
        </div>
        <nav class="mainmenu mobile-menu">
            <ul>
                <li class="active"><a asp-controller="Home" asp-action="Index">Home</a></li>
                <li><<a asp-controller="Home" asp-action="rooms">Rooms</a></li>
                <li><a asp-controller="Home" asp-action="about">About Us</a></li>
                <li>
                    <a href="./pages.html">Pages</a>
                    <ul class="dropdown">
                        <li><a href="./room-details.html">Room Details</a></li>
                        <li><a href="./blog-details.html">Blog Details</a></li>
                        <li><a href="#">Family Room</a></li>
                        <li><a href="#">Premium Room</a></li>
                    </ul>
                </li>
                <li><a asp-controller="Blog" asp-action="Index">Blogs</a></li>
                <li><a asp-controller="Home" asp-action="Contact">Contact</a></li>
            </ul>
        </nav>
        <div id="mobile-menu-wrap"></div>
        <div class="top-social">
            <a href="#"><i class="fa fa-facebook"></i></a>
            <a href="#"><i class="fa fa-twitter"></i></a>
            <a href="#"><i class="fa fa-tripadvisor"></i></a>
            <a href="#"><i class="fa fa-instagram"></i></a>
        </div>
        <ul class="top-widget">
            <li><i class="fa fa-phone"></i> (12) 345 67890</li>
            <li><i class="fa fa-envelope"></i> info.colorlib@gmail.com</li>
        </ul>
    </div>
    <!-- Offcanvas Menu Section End -->
    <!-- Header Section Begin -->
    <header class="header-section">
        <div class="top-nav">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6">
                        <ul class="tn-left">
                            <li><i class="fa fa-phone"></i> (12) 345 67890</li>
                            <li><i class="fa fa-envelope"></i> info.colorlib@gmail.com</li>
                        </ul>
                    </div>
                    <div class="col-lg-6">
                        <div class="tn-right">
                            <div class="top-social">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-tripadvisor"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                            </div>
                            <a href="#" class="bk-btn">Booking Now</a>
                            <div class="language-option">
                                <img src="img/flag.jpg" alt="">
                                <span>EN <i class="fa fa-angle-down"></i></span>
                                <div class="flag-dropdown">
                                    <ul>
                                        <li><a href="#">Zi</a></li>
                                        <li><a href="#">Fr</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu-item">
            <div class="container">
                <div class="row">
                    <div class="col-lg-2">
                        <div class="logo">
                            <a href="./index.html">
                                <img src="img/logo.png" alt="">
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-10">
                        <div class="nav-menu">
                            <nav class="mainmenu">
                                <ul>
                                    <li class="active"><a asp-controller="Home" asp-action="Index">Home</a></li>
                                    <li><<a asp-controller="Home" asp-action="rooms">Rooms</a></li>
                                    <li><a asp-controller="Home" asp-action="about">About Us</a></li>
                                    <li>
                                        <a href="./pages.html">Pages</a>
                                        <ul class="dropdown">
                                            <li><a href="./room-details.html">Room Details</a></li>
                                            <li><a href="./blog-details.html">Blog Details</a></li>
                                            <li><a href="#">Family Room</a></li>
                                            <li><a href="#">Premium Room</a></li>
                                        </ul>
                                    </li>
                                    <li><a asp-controller="Blog" asp-action="Index">Blogs</a></li>
                                    <li><a asp-controller="Home" asp-action="Contact">Contact</a></li>
                                </ul>
                            </nav>
                            <div class="nav-right search-switch">
                                <i class="icon_search"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Header End -->
    <!-- Blog Details Section Begin -->
    <section class="blog-details-section">
    <div class="container">
        <div class="row">
            <div>
                <h2>@Html.DisplayFor(model => model.Title)</h2>
            </div>
        </div>
        <div class="row">
            <div>
                <p><i class="icon_profile"></i> @Html.DisplayFor(modelItem => Model.AppUser.Name)</p>
            </div>
            <div>
                <p class="b-time">@Html.DisplayFor(model => model.CreateAt)</p>
            </div>
        </div>
        <div class="row">
            <div>
                <p class="b-time">@Html.DisplayFor(model => model.BriefInfor)</p>
            </div>
        </div>
            <div class="row">
                <div class="col-lg-10 offset-lg-1">
                    <div class="blog-details-text">
                        
                       
                        <div class="bd-title">
                            <div>
                                @Html.Raw(Model.Content)
                            </div>
                        </div>
                        
                        <div class="tag-share">
                            <div class="tags">
                                <a href="#">Travel Trip</a>
                                <a href="#">Camping</a>
                                <a href="#">Event</a>
                            </div>
                            <div class="social-share">
                                <span>Share:</span>
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-tripadvisor"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                                <a href="#"><i class="fa fa-youtube-play"></i></a>
                            </div>
                        </div>
                        <div class="comment-option">
                        <h4>@Model.Comments.Count() Comments</h4>
                        <div id="commentList">

                        
                        @foreach (var item in Model.Comments)
                        {
                            <div class="single-comment-item first-comment">
                                <div class="sc-author">
                                    <img src="https://firebasestorage.googleapis.com/v0/b/image-upload-62189.appspot.com/o/pngtree-flat-contact-png-image_4420854.jpg?alt=media&token=84930ea1-d87b-4541-9fe4-90cac627042f" alt="">
                                </div>
                                <div class="sc-text">
                                    <span>@Html.DisplayFor(modelItem => item.CreatedDate)</span>
                                    <h5>@Html.DisplayFor(modelItem => item.AppUser.Name)</h5>
                                    <p>
                                        @Html.DisplayFor(modelItem => item.Content)
                                    </p>
                                    <img class="x1b0d499 xl1xv1r" alt="" aria-hidden="true" src="https://scontent.fhan2-3.fna.fbcdn.net/m1/v/t6/An-HX414PnqCVzyEq9OFFdayyrdj8c3jnyPbPcierija6hpzsUvw-1VPQ260B2M9EbxgmP7pYlNQSjYAXF782_vnvvpDLxvJQD74bwdWEJ0DhcErkDga6gazZZUYm_Q.png?ccb=10-5&amp;oh=00_AYC0im9QT2OWXd5hY_Z4gcW3Os70GyfvS-0SqqAz_2Pnmw&amp;oe=67243C63&amp;_nc_sid=7da55a" style="height: 20px; width: 20px;">
                                    <span id="like-count-@item.CommentID">@item.Likes</span> <!-- Hiển thị số lượt like -->
                                    <button type="button" class="comment-btn like-btn" id="like-btn-@item.CommentID" data-comment-id="@item.CommentID">
                                        Like
                                    </button>
                                    <a href="javascript:void(0);" class="comment-btn reply-btn" data-comment-id="@item.CommentID">Reply</a>
                                    <!-- Reply Form -->
                                    <div class="reply-form" id="reply-form-@item.CommentID" style="display:none;">
                                        <form id="comment-form-@item.CommentID" asp-controller="Comment" asp-action="CreateComment" method="post" class="comment-form">
                                            <input type="hidden" name="BlogId" value="@Model?.Id" />
                                            <input type="hidden" name="ParentCommentId" value="@item.CommentID" />
                                            <div class="row">
                                                <div class="col-lg-12 text-center">
                                                    <textarea name="Content" placeholder="Type your reply here..."></textarea>
                                                    <button type="submit" class="site-btn">Send Reply</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                <!-- This is where the comments will be appended dynamically -->
                                        <div id="comments-section">
                                            <!-- Existing comments will be here -->
                                        </div>

                                </div>
                            </div>
                        }
                        </div>
                        <br />
                        <div class="leave-comment">
                           <div class="leave-comment">
                            <h4>Leave A Comment</h4>
                            <form id="commentForm" method="post" class="comment-form">
                                <input type="hidden" name="BlogId" value="@Model.Id" />
                                <div class="row">
                                    <div class="col-lg-12 text-center">
                                        <textarea name="Content" placeholder="Messages" required></textarea>
                                        <button type="submit" class="site-btn">Send Message</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                  </div>
            </div>
        </div>
    </section>
    <!-- Blog Details Section End -->
    <!-- Recommend Blog Section Begin -->
    <section class="recommend-blog-section spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <h2>Recommended</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="blog-item set-bg" data-setbg="img/blog/blog-1.jpg">
                        <div class="bi-text">
                            <span class="b-tag">Travel Trip</span>
                            <h4><a href="#">Tremblant In Canada</a></h4>
                            <div class="b-time"><i class="icon_clock_alt"></i> 15th April, 2019</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="blog-item set-bg" data-setbg="img/blog/blog-2.jpg">
                        <div class="bi-text">
                            <span class="b-tag">Camping</span>
                            <h4><a href="#">Choosing A Static Caravan</a></h4>
                            <div class="b-time"><i class="icon_clock_alt"></i> 15th April, 2019</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="blog-item set-bg" data-setbg="img/blog/blog-3.jpg">
                        <div class="bi-text">
                            <span class="b-tag">Event</span>
                            <h4><a href="#">Copper Canyon</a></h4>
                            <div class="b-time"><i class="icon_clock_alt"></i> 21th April, 2019</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Recommend Blog Section End -->
    <!-- Footer Section Begin -->
    <footer class="footer-section">
        <div class="container">
            <div class="footer-text">
                <div class="row">
                    <div class="col-lg-4">
                        <div class="ft-about">
                            <div class="logo">
                                <a href="#">
                                    <img src="img/footer-logo.png" alt="">
                                </a>
                            </div>
                            <p>We inspire and reach millions of travelers<br /> across 90 local websites</p>
                            <div class="fa-social">
                                <a href="#"><i class="fa fa-facebook"></i></a>
                                <a href="#"><i class="fa fa-twitter"></i></a>
                                <a href="#"><i class="fa fa-tripadvisor"></i></a>
                                <a href="#"><i class="fa fa-instagram"></i></a>
                                <a href="#"><i class="fa fa-youtube-play"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 offset-lg-1">
                        <div class="ft-contact">
                            <h6>Contact Us</h6>
                            <ul>
                                <li>(12) 345 67890</li>
                                <li>info.colorlib@gmail.com</li>
                                <li>856 Cordia Extension Apt. 356, Lake, United State</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 offset-lg-1">
                        <div class="ft-newslatter">
                            <h6>New latest</h6>
                            <p>Get the latest updates and offers.</p>
                            <form action="#" class="fn-form">
                                <input type="text" placeholder="Email">
                                <button type="submit"><i class="fa fa-send"></i></button>
                            </form>
                        </div>
                    </div>
                </div<footer b-7dmtl713c2="" class="border-top footer text-muted">
    </footer>
            </div>
        </div>
        <div class="copyright-option">
            <div class="container">
                <div class="row">
                    <div class="col-lg-7">
                        <ul>
                            <li><a href="#">Contact</a></li>
                            <li><a href="#">Terms of use</a></li>
                            <li><a href="#">Environmental Policy</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-5">
                        <div class="co-text">
                            <p>
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->
    <!-- Search model Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch"><i class="icon_close"></i></div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search model end -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
    $(document).ready(function () {
    // Bắt sự kiện click vào nút like
    $(document).on('click', '.like-btn', function (e) {
        e.preventDefault(); // Ngăn hành động mặc định của nút

        // Lấy CommentId từ thuộc tính data
        var commentId = $(this).data('comment-id');
        var blogId = '@Model?.Id'; // Bạn có thể truyền giá trị BlogId từ Razor

        // Gọi AJAX POST để thực hiện Like
        $.ajax({
            url: '@Url.Action("Like", "Comment")', // Đường dẫn đến action Like trong controller Comment
            type: 'POST',
            data: {
                commentId: commentId,
                blogId: blogId
            },
            headers: {
                'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() // CSRF token
            },
            success: function (response) {
                if (response.success) {
                    // Cập nhật số lượt like trong giao diện
                    var likesCount = parseInt($(`#like-count-${commentId}`).text());
                    likesCount = response.liked ? likesCount + 1 : likesCount - 1; // Tăng hoặc giảm số like
                    $(`#like-count-${commentId}`).text(likesCount);

                    // Cập nhật text của nút like
                    if (response.liked) {
                        $(`#like-btn-${commentId}`).text('Unlike');
                    } else {
                        $(`#like-btn-${commentId}`).text('Like');
                    }
                } else {
                    // Xử lý nếu không thành công
                    alert(response.message || 'Có lỗi xảy ra!');
                }
            },
            error: function (xhr, status, error) {
                // Xử lý lỗi
                alert('Lỗi khi thực hiện like: ' + error);
            }
        });
    });
});

</script>


    </script>

    <script>
        $(document).ready(function() {
    $('#commentForm').on('submit', function(event) {
        event.preventDefault(); // Ngăn chặn gửi form mặc định

        // Lấy dữ liệu từ form
        var formData = $(this).serialize();

        $.ajax({
            url: '@Url.Action("CreateComment", "Comment")', // Địa chỉ URL của hành động CreateComment
            type: 'POST',
            data: formData,
            success: function(response) {
                console.log(response); // In phản hồi từ server để kiểm tra

                if (response.success) {
                    // Thêm bình luận vào danh sách bình luận
                
                        var commentHtml = `
                        <div class="single-comment-item first-comment">
                            <div class="sc-author">
                                <img src="https://firebasestorage.googleapis.com/v0/b/image-upload-62189.appspot.com/o/pngtree-flat-contact-png-image_4420854.jpg?alt=media&token=84930ea1-d87b-4541-9fe4-90cac627042f" alt="User Avatar">
                            </div>
                            <div class="sc-text">
                                <span>(${new Date(response.comment.createdDate).toLocaleString() || "Invalid Date"})</span>
                                <h5><strong>${response.comment.userName || "Anonymous"}</strong></h5>
                                <p>${response.comment.content || "No content"}</p>
                                <img class="x1b0d499 xl1xv1r" alt="" aria-hidden="true" src="https://scontent.fhan2-3.fna.fbcdn.net/m1/v/t6/An-HX414PnqCVzyEq9OFFdayyrdj8c3jnyPbPcierija6hpzsUvw-1VPQ260B2M9EbxgmP7pYlNQSjYAXF782_vnvvpDLxvJQD74bwdWEJ0DhcErkDga6gazZZUYm_Q.png?ccb=10-5&amp;oh=00_AYC0im9QT2OWXd5hY_Z4gcW3Os70GyfvS-0SqqAz_2Pnmw&amp;oe=67243C63&amp;_nc_sid=7da55a" style="height: 20px; width: 20px;">
                                <button type="button" class="comment-btn like-btn" id="like-btn-${response.comment.commentID}" data-comment-id="${response.comment.commentID}">
                                        Like
                                    </button>
                                <a href="javascript:void(0);" class="comment-btn reply-btn" data-comment-id="${response.comment.commentID}">Reply</a>
                                <!-- Reply Form -->
                                <div class="reply-form" id="reply-form-${response.comment.commentID}" style="display:none;">
                                    <form id="comment-form-${response.comment.commentID}" asp-controller="Comment" asp-action="CreateComment" method="post" class="comment-form">
                                        <input type="hidden" name="BlogId" value="@Model?.Id" />
                                        <input type="hidden" name="ParentCommentId" value="${response.comment.commentID}" />
                                        <div class="row">
                                            <div class="col-lg-12 text-center">
                                                <textarea name="Content" placeholder="Type your reply here..."></textarea>
                                                <button type="submit" class="site-btn">Send Reply</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                         </div>
                    `;

                

                    // Thêm bình luận mới vào đầu danh sách
                    $('#commentList').append(commentHtml);
                
                    // Thông báo thành công
                    alert('Comment posted successfully!');
                
                    // Dọn dẹp nội dung của textarea sau khi gửi
                    $('textarea[name="Content"]').val('');
                } else {
                    // Xử lý nếu không thành công
                    alert(response.message || "An error occurred while posting the comment.");
                }
            },
            error: function(xhr, status, error) {
                // Xử lý lỗi
                alert('An error occurred: ' + error);
            }
        });
    });
});

    </script>

    <!-- Js Plugins -->
    <script src="~/js/jquery-3.3.1.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/jquery.magnific-popup.min.js"></script>
    <script src="~/js/jquery.nice-select.min.js"></script>
    <script src="~/js/jquery-ui.min.js"></script>
    <script src="~/js/jquery.slicknav.js"></script>
    <script src="~/js/owl.carousel.min.js"></script>
    <script src="~/js/main.js"></script>

          


    <script>
    document.querySelectorAll('.reply-btn').forEach(button => {
        button.addEventListener('click', function () {
            const commentId = this.getAttribute('data-comment-id');
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none'; // Hiện/ẩn form trả lời
        });
    });
</script>

</body>

</html>